name: Post Newsletter to Buttondown

on:
  workflow_dispatch:
  schedule: # every Sunday at 3am CET (2am UTC)
    - cron: '0 2 * * 0'

jobs:
  post-newsletter:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - uses: actions/checkout@v6

    - uses: actions/setup-go@v6
      with:
        go-version: '1.25'

    - name: Build
      run: go build ./...

    - name: Post to Buttondown
      env:
        BUTTONDOWN_API_KEY: ${{ secrets.BUTTONDOWN_API_KEY }}
        RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
      run: ./debugjois.dev build-newsletter --post --notify
